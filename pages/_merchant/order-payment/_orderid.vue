<template>
  <section id="common-success" class="section content container">
    <div id="contents">
      <div id="main-content">
        <div class="holder">
          <div class="content">
            <div class="success-msg">
              <div id="lottie">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 271 271"
                  width="271"
                  height="271"
                  preserveAspectRatio="xMidYMid meet"
                  style="
                    width: 100%;
                    height: 100%;
                    transform: translate3d(0px, 0px, 0px);
                  "
                >
                  <defs>
                    <clipPath id="animationMask_HQLjxTsXig">
                      <rect width="271" height="271" x="0" y="0"></rect>
                    </clipPath>
                  </defs>
                  <g clip-path="url(#animationMask_HQLjxTsXig)">
                    <g
                      style="display: none"
                      transform="matrix(0.9863709211349487,0,0,0.9863709211349487,135.3580322265625,135.96035766601562)"
                      opacity="0.016420567642957594"
                    >
                      <g
                        opacity="1"
                        transform="matrix(0.6534199714660645,0,0,0.6534199714660645,108.5,-120.75)"
                      >
                        <path
                          fill="rgb(80,210,130)"
                          fill-opacity="1"
                          d=" M0,-8.25 C4.55317497253418,-8.25 8.25,-4.55317497253418 8.25,0 C8.25,4.55317497253418 4.55317497253418,8.25 0,8.25 C-4.55317497253418,8.25 -8.25,4.55317497253418 -8.25,0 C-8.25,-4.55317497253418 -4.55317497253418,-8.25 0,-8.25z"
                        ></path>
                        <path
                          stroke-linecap="butt"
                          stroke-linejoin="miter"
                          fill-opacity="0"
                          stroke-miterlimit="4"
                          stroke="rgb(38,161,85)"
                          stroke-opacity="1"
                          stroke-width="5"
                          d="M0 0"
                        ></path>
                      </g>
                    </g>
                    <g
                      style="display: none"
                      transform="matrix(0.9863709211349487,0,0,0.9863709211349487,155.84396362304688,136.56320190429688)"
                      opacity="0.016420567642957594"
                    >
                      <g
                        opacity="1"
                        transform="matrix(0.6534199714660645,0,0,0.6534199714660645,108.5,-120.75)"
                      >
                        <path
                          fill="rgb(80,210,130)"
                          fill-opacity="1"
                          d=" M0,-8.25 C4.55317497253418,-8.25 8.25,-4.55317497253418 8.25,0 C8.25,4.55317497253418 4.55317497253418,8.25 0,8.25 C-4.55317497253418,8.25 -8.25,4.55317497253418 -8.25,0 C-8.25,-4.55317497253418 -4.55317497253418,-8.25 0,-8.25z"
                        ></path>
                        <path
                          stroke-linecap="butt"
                          stroke-linejoin="miter"
                          fill-opacity="0"
                          stroke-miterlimit="4"
                          stroke="rgb(38,161,85)"
                          stroke-opacity="1"
                          stroke-width="5"
                          d="M0 0"
                        ></path>
                      </g>
                    </g>
                    <g
                      style="display: none"
                      transform="matrix(0.9863709211349487,0,0,0.9863709211349487,164.73321533203125,155.28890991210938)"
                      opacity="0.016420567642957594"
                    >
                      <g
                        opacity="1"
                        transform="matrix(0.6534199714660645,0,0,0.6534199714660645,108.5,-120.75)"
                      >
                        <path
                          fill="rgb(80,210,130)"
                          fill-opacity="1"
                          d=" M0,-8.25 C4.55317497253418,-8.25 8.25,-4.55317497253418 8.25,0 C8.25,4.55317497253418 4.55317497253418,8.25 0,8.25 C-4.55317497253418,8.25 -8.25,4.55317497253418 -8.25,0 C-8.25,-4.55317497253418 -4.55317497253418,-8.25 0,-8.25z"
                        ></path>
                        <path
                          stroke-linecap="butt"
                          stroke-linejoin="miter"
                          fill-opacity="0"
                          stroke-miterlimit="4"
                          stroke="rgb(38,161,85)"
                          stroke-opacity="1"
                          stroke-width="5"
                          d="M0 0"
                        ></path>
                      </g>
                    </g>
                    <g
                      transform="matrix(1,0,0,1,-11.498992919921875,-11.5)"
                      opacity="0.041781155543080505"
                      style="display: none"
                    >
                      <g
                        opacity="1"
                        transform="matrix(1,0,0,1,144.49899291992188,144.5)"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="miter"
                          fill-opacity="0"
                          stroke-miterlimit="10"
                          stroke="rgb(228,228,228)"
                          stroke-opacity="1"
                          stroke-width="20"
                          d=" M40.08300018310547,-85.802001953125 C28.0939998626709,-91.2699966430664 14.734000205993652,-94.1729965209961 -0.0010000000474974513,-94.5 C-26.917999267578125,-93.90299987792969 -49.24599838256836,-84.73899841308594 -66.99199676513672,-66.99299621582031 C-84.73899841308594,-49.24700164794922 -93.91000366210938,-26.910999298095703 -94.4990005493164,0 C-93.91000366210938,26.917999267578125 -84.73899841308594,49.24700164794922 -66.99199676513672,66.99299621582031 C-49.24599838256836,84.73999786376953 -26.917999267578125,93.90399932861328 -0.0010000000474974513,94.5 C26.910999298095703,93.90399932861328 49.24599838256836,84.73999786376953 66.99199676513672,66.99299621582031 C84.73899841308594,49.24700164794922 93.90399932861328,26.917999267578125 94.4990005493164,0 C94.38300323486328,-5.26800012588501 93.9260025024414,-10.354000091552734 93.15299987792969,-15.270999908447266"
                        ></path>
                      </g>
                    </g>
                    <g
                      transform="matrix(1,0,0,1,-11.498992919921875,-11.5)"
                      opacity="0.046438485689758696"
                      style="display: none"
                    >
                      <g
                        opacity="1"
                        transform="matrix(1,0,0,1,144.49899291992188,144.5)"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="miter"
                          fill-opacity="0"
                          stroke-miterlimit="10"
                          stroke="rgb(37,161,84)"
                          stroke-opacity="1"
                          stroke-width="20"
                          d=" M44.638999938964844,-83.56600189208984 C31.506999969482422,-90.48100280761719 16.628999710083008,-94.13099670410156 -0.0010000000474974513,-94.5 C-26.917999267578125,-93.90299987792969 -49.24599838256836,-84.73899841308594 -66.99199676513672,-66.99299621582031 C-84.73899841308594,-49.24700164794922 -93.91000366210938,-26.910999298095703 -94.4990005493164,0 C-93.91000366210938,26.917999267578125 -84.73899841308594,49.24700164794922 -66.99199676513672,66.99299621582031 C-49.24599838256836,84.73999786376953 -26.917999267578125,93.90399932861328 -0.0010000000474974513,94.5 C26.910999298095703,93.90399932861328 49.24599838256836,84.73999786376953 66.99199676513672,66.99299621582031 C84.73899841308594,49.24700164794922 93.90399932861328,26.917999267578125 94.4990005493164,0 C94.38300323486328,-5.26800012588501 93.9260025024414,-10.354000091552734 93.15299987792969,-15.270999908447266"
                        ></path>
                      </g>
                    </g>
                    <g
                      transform="matrix(1,0,0,1,-11.498992919921875,-11.5)"
                      opacity="1"
                      style="display: block"
                    >
                      <g
                        opacity="1"
                        transform="matrix(1,0,0,1,144.49899291992188,144.5)"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="miter"
                          fill-opacity="0"
                          stroke-miterlimit="10"
                          stroke="rgb(80,210,130)"
                          stroke-opacity="1"
                          stroke-width="20"
                          d=" M44.638999938964844,-83.56600189208984 C31.506999969482422,-90.48100280761719 16.628999710083008,-94.13099670410156 -0.0010000000474974513,-94.5 C-26.917999267578125,-93.90299987792969 -49.24599838256836,-84.73899841308594 -66.99199676513672,-66.99299621582031 C-84.73899841308594,-49.24700164794922 -93.91000366210938,-26.910999298095703 -94.4990005493164,0 C-93.91000366210938,26.917999267578125 -84.73899841308594,49.24700164794922 -66.99199676513672,66.99299621582031 C-49.24599838256836,84.73999786376953 -26.917999267578125,93.90399932861328 -0.0010000000474974513,94.5 C26.910999298095703,93.90399932861328 49.24599838256836,84.73999786376953 66.99199676513672,66.99299621582031 C84.73899841308594,49.24700164794922 93.90399932861328,26.917999267578125 94.4990005493164,0 C94.38300323486328,-5.26800012588501 93.9260025024414,-10.354000091552734 93.15299987792969,-15.270999908447266"
                        ></path>
                      </g>
                    </g>
                    <g
                      transform="matrix(1,0,0,1,35.5,-5.5)"
                      opacity="1"
                      style="display: block"
                    >
                      <g opacity="1" transform="matrix(1,0,0,1,128,108.5)">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          fill-opacity="0"
                          stroke="rgb(228,228,228)"
                          stroke-opacity="1"
                          stroke-width="19"
                          d=" M-80.5,17 C-80.5,17 -36.5,61 -36.5,61 C-36.5,61 80.5,-61 80.5,-61"
                        ></path>
                      </g>
                    </g>
                    <g
                      transform="matrix(1,0,0,1,35.5,-5.5)"
                      opacity="1"
                      style="display: block"
                    >
                      <g opacity="1" transform="matrix(1,0,0,1,128,108.5)">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          fill-opacity="0"
                          stroke="rgb(38,161,85)"
                          stroke-opacity="1"
                          stroke-width="19"
                          d=" M-80.5,17 C-80.5,17 -36.5,61 -36.5,61 C-36.5,61 80.5,-61 80.5,-61"
                        ></path>
                      </g>
                    </g>
                    <g
                      transform="matrix(1,0,0,1,35.5,-5.5)"
                      opacity="1"
                      style="display: block"
                    >
                      <g opacity="1" transform="matrix(1,0,0,1,128,108.5)">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          fill-opacity="0"
                          stroke="rgb(80,210,130)"
                          stroke-opacity="1"
                          stroke-width="19"
                          d=" M-80.5,17 C-80.5,17 -36.5,61 -36.5,61 C-36.5,61 80.5,-61 80.5,-61"
                        ></path>
                      </g>
                    </g>
                  </g>
                </svg>
              </div>
              <div class="message">
                <div class="title" style="font-size:21px!important;">
                  <b>
                    {{ $t("your-order") }} #NO{{ invoice_number
                    }}{{ $t("has-been-placed") }}</b
                  >
                </div>
              </div>
            
              <!-- <div class="message">
                <div class="title">
                  <b>
                    {{ $t("your-order") }} #NO{{ invoice_number
                    }}{{ $t("has-been-placed") }}</b
                  >
                </div>
                <p>{{ $t("successfully-placed") }}</p>
                <p>
                  {{ $t("direct-question") }}
                  <a href="#" @click="contact_store()">{{
                    $t("store-owner")
                  }}</a
                  >.
                </p>
                <p>{{ $t("thanks-shopping") }}</p>
              </div> -->
            </div>
              <div class="qr-payment" v-if="order_payment_method == '3'">
                <div id="e-payment" class="e_tngpay">
                  <div class="e-payment-container">
                    <div class="qr-code-msg">
                      <span
                        ><b>{{ $t("scan-qr") }}</b></span
                      >
                      <span style="font-size: 35px">
                        RM{{
                          (
                            parseFloat(total_fee) +
                            (tax_fee ? parseFloat(tax_fee) : 0) -
                            parseFloat(discount_amount) -
                            parseFloat(coupon_discount_amount) +
                            parseFloat(delivery_fee)
                          ).toFixed(2)
                        }}</span
                      >
                    </div>
                    <div class="qr-code-container">
                      <div class="qr-code-brand" style="background-color: #0257b1;">
                        <img src="@/assets/images/tng-wallet-background.jpg" />
                      </div>
                      <div class="qr-code">
                        <img :src="tng_image" alt="e_tngpay" />
                      </div>
                    </div>
                  </div>
                  <!-- <v-row class="mt-2" justify="center">
                    <v-btn color="primary" large @click="continue_whatsapp()">
                      {{ $t("continue") }}
                    </v-btn>
                  </v-row> -->
                </div>
              </div>

              <div class="qr-payment" v-if="order_payment_method == '4'">
                <div id="e-payment" class="e_tngpay">
                  <div class="e-payment-container">
                    <div class="qr-code-msg">
                      <span
                        ><b>{{ $t("scan-qr") }}</b></span
                      >
                      <span style="font-size: 35px">
                        RM{{
                          (
                            parseFloat(total_fee) +
                            (tax_fee ? parseFloat(tax_fee) : 0) -
                            parseFloat(discount_amount) -
                            parseFloat(coupon_discount_amount) +
                            parseFloat(delivery_fee)
                          ).toFixed(2)
                        }}</span
                      >
                    </div>
                    <div class="qr-code-container">
                      <div class="qr-code-brand" style="background-color: #f22e16;">
                        <img src="@/assets/images/boost-wallet-background.jpg" />
                      </div>
                      <div class="qr-code">
                        <img :src="boost_image" alt="e_boostpay" />
                      </div>
                    </div>
                  </div>
                  <!-- <v-row class="mt-2" justify="center">
                    <v-btn color="primary" large @click="continue_whatsapp()">
                      {{ $t("continue") }}
                    </v-btn>
                  </v-row> -->
                </div>
              </div>

              <div class="qr-payment" v-if="order_payment_method == '5'">
                <div id="e-payment" class="e_tngpay">
                  <div class="e-payment-container">
                    <div class="qr-code-msg">
                      <span
                        ><b>{{ $t("scan-qr") }}</b></span
                      >
                      <span style="font-size: 35px">
                        RM{{
                          (
                            parseFloat(total_fee) +
                            (tax_fee ? parseFloat(tax_fee) : 0) -
                            parseFloat(discount_amount) -
                            parseFloat(coupon_discount_amount) +
                            parseFloat(delivery_fee)
                          ).toFixed(2)
                        }}</span
                      >
                    </div>
                    <div class="qr-code-container">
                      <div class="qr-code-brand" style="background-color: #ec2f67;">
                        <img src="@/assets/images/duit-now-wallet-background.jpg" />
                      </div>
                      <div class="qr-code">
                        <img :src="duit_now_image" alt="e_duitnowpay" />
                      </div>
                    </div>
                  </div>
                  <!-- <v-row class="mt-2" justify="center">
                    <v-btn color="primary" large @click="continue_whatsapp()">
                      {{ $t("continue") }}
                    </v-btn>
                  </v-row> -->
                </div>
              </div>

              <div class="qr-payment" v-if="order_payment_method == '6'">
                <div id="e-payment" class="e_tngpay">
                  <div class="e-payment-container">
                    <div class="qr-code-msg">
                      <span
                        ><b>{{ $t("scan-qr") }}</b></span
                      >
                      <span style="font-size: 35px">
                        RM{{
                          (
                            parseFloat(total_fee) +
                            (tax_fee ? parseFloat(tax_fee) : 0) -
                            parseFloat(discount_amount) -
                            parseFloat(coupon_discount_amount) +
                            parseFloat(delivery_fee)
                          ).toFixed(2)
                        }}</span
                      >
                    </div>
                    <div class="qr-code-container">
                      <div class="qr-code-brand" style="background-color: #f68122;">
                        <img src="@/assets/images/sarawak-pay-wallet-background.jpg" />
                      </div>
                      <div class="qr-code">
                        <img :src="sarawak_pay_image" alt="e_sarawakpay" />
                      </div>
                    </div>
                  </div>
                  <!-- <v-row class="mt-2" justify="center">
                    <v-btn color="primary" large @click="continue_whatsapp()">
                      {{ $t("continue") }}
                    </v-btn>
                  </v-row> -->
                </div>
              </div>

              <div class="qr-payment" v-if="order_payment_method == '0'">
                <div id="e-payment" class="e_tngpay">
                  <div class="e-payment-container">
                    <div class="qr-code-msg">
                      <span
                        ><b> {{ $t("online-transfer-below") }}</b></span
                      >
                      <span style="font-size: 35px">
                        RM{{
                          (
                            parseFloat(total_fee) +
                            (tax_fee ? parseFloat(tax_fee) : 0) -
                            parseFloat(discount_amount) -
                            parseFloat(coupon_discount_amount) +
                            parseFloat(delivery_fee)
                          ).toFixed(2)
                        }}</span
                      >
                    </div>
                    <v-card class="mt-1">
                      <v-card-subtitle class="justify-start"
                        ><b>{{ $t("bank-details") }}</b>
                      </v-card-subtitle>
                      <v-divider class="mx-1"> </v-divider>
                      <v-card-text>
                        <div class="bank_detail2">
                          <v-card-subtitle
                          style="font-size:16px;"
                            class="bank_detail"
                            v-html="bank_details"
                          >
                          </v-card-subtitle>
                        </div>
                      </v-card-text>
                    </v-card>
                  </div>
                  <!-- <v-row class="mt-2" justify="center">
                    <v-btn color="primary" large @click="continue_whatsapp()">
                      {{ $t("continue") }}
                    </v-btn>
                  </v-row> -->
                </div>
              </div>
    
          </div>
      <v-row class="mt-2 mb-2" justify="center" v-if="payment_receipt!==''">
        <v-col cols="12">
          <iframe
                     class="mt-4"
                     v-if="order_payment_receipt_extension=='pdf'"
                     :src="domain+'/order/receipt/'+merchant_id+'/'+payment_receipt" width="250px" height="350px"
                   frameBorder="0"
                  scrolling="auto"
                ></iframe>
                <v-img v-if="(payment_status=='2' || payment_receipt!=='') && order_payment_receipt_extension!=='pdf'" :src="domain+'order/receipt/'+merchant_id+'/'+payment_receipt" contain height="300px" ></v-img>
        </v-col>
      </v-row>
              <v-row class="mt-2 mb-5" justify="center">
                  <!-- <v-col cols="6"> -->

                    <!-- <v-btn :dark="p_dark" :color="p_color" class="ma-2" x-large @click="open_upload_dialog()" v-if="allow_receipt==0 && payment_status!=='2'">
                      {{ $t("upload-receipt") }}
                    </v-btn> -->

                      <v-btn style="width:90%"
                      :dark="p_dark" :color="p_color" class="ma-0 my-4 mr-1 white--text rounded-lg" x-large @click="open_upload_dialog()" v-if="allow_receipt==0 && payment_status!=='2'"
                      depressed tile 
                       >
                         <span style="font-size:16px">   {{ $t("upload-receipt") }}</span>
                      </v-btn>


                    <!-- <v-btn :dark="s_dark" :color="s_color" class="ma-2" large @click="continue_whatsapp()" v-else>
                      {{ $t("continue") }}
                    </v-btn> -->

                    <v-btn style="width:90%" :dark="s_dark" :color="s_color"  @click="continue_whatsapp()" v-else
                    class="ma-0 my-4 mr-1 white--text rounded-lg" x-large
                      depressed tile 
                       >
                             {{ $t("continue") }}
                      </v-btn>
                    
                  <!-- </v-col> -->

              </v-row>
        </div>
      </div>
    </div>
    <v-dialog width="400px" v-model="receipt_dialog">
      <v-card>
        <v-card-title><b>Upload Receipt</b></v-card-title>
        <v-card-text>
          <v-row  v-if="image_url!==''" justify="center" align="center">
            <v-col cols="12"  justify="center" align="center">
            <v-img :src="image_url" width="200px"></v-img>
          <!-- <embed :src="image_url" type="application/pdf" width="100%" height="600px" /> -->
            <!-- <iframe :src="image_url" width="400px" height="2500px" ></iframe> -->
            </v-col>
          
          </v-row>
          <v-row>
        <v-file-input class="mt-5" label="Upload Receipt" accept="image/png, image/jpeg,.pdf" v-model="image_file" @change="receipt_upload()"
            :rules="image_rules" solo placeholder="Upload" persistent-hint hint="*maximum size 3mb">
           </v-file-input>
           </v-row>

         </v-card-text>
            <v-card-actions>
               <v-spacer></v-spacer>
                <v-btn color="error" outlined @click="receipt_dialog=false">Cancel
                 </v-btn>

                  <v-btn color="success" :loading="receipt_loading" outlined @click="save_picture_and_go()">Continue</v-btn>
                </v-card-actions>
      </v-card>
    </v-dialog>
    <v-snackbar
      v-model="error_snackbar"
      :bottom="true"
      dark
      color="pink lighten-3"
      elevation="24"
    >
      <span style="font-size:13px">{{ error_snackbar_text }} </span>
      <v-btn color="red" text @click="error_snackbar = false">{{$t('close')}}</v-btn>
    </v-snackbar>
  </section>
</template>

<script>
// import Logo from '~/components/Logo.vue'
// import VuetifyLogo from '~/components/VuetifyLogo.vue'
// import axios from 'axios'
import { BASEURL } from "@/api/baseurl";
import axios from "axios";
export default {
  // components: {
  //   Logo,
  //   VuetifyLogo
  // },
  data() {
    return {
      domain: BASEURL,
      unsavedChanges: true,
      receipt_dialog:false,
      receipt_loading:false,
      image_file:'',
      image_url:'',
      testimage:'',
      image_rules: [
            value => !value || value.size < 2048000 || 'Image size should be less than 2 MB!',
      ],
      error_snackbar: false,
      error_snackbar_text: "",
      order_id:'',
      allow_whatsapp:''
    };
  },
  async asyncData({ params, $axios }) {
    const orderData = new URLSearchParams();

    orderData.append("id", `${params.orderid}`);
    orderData.append("view_order", "view_order");



    let orderResponse = await $axios.$post("order/index.php", orderData);
    if (orderResponse.status !== "1") {
      window.location.href = "https://emenu.com.my/" + `${params.merchant}`;
      return;
    }
    var discount_amount =
      orderResponse.order[0].discount_amount == "" ||
      orderResponse.order[0].discount_amount == null
        ? 0
        : orderResponse.order[0].discount_amount;
    var coupon_discount_amount =
      orderResponse.order[0].coupon_discount_amount == "" ||
      orderResponse.order[0].coupon_discount_amount == null
        ? 0
        : orderResponse.order[0].coupon_discount_amount;
         var order_payment_receipt_extension='';
         var pay_receipt=orderResponse.order[0].payment_receipt;
      if(orderResponse.order[0].payment_receipt!==''){
            order_payment_receipt_extension = pay_receipt.substr(pay_receipt.lastIndexOf('.') + 1);
      }

      if (orderResponse.order[0].color !=='') {
        console.log('ge');
        var color = JSON.parse(orderResponse.order[0].color);

        var p_color = color.primary_color;
        var s_color = color.second_color;

      }else{
         var p_color = "#000000";
        var s_color = "#666f7b";
      }


    return {
      url: `${params.orderid}`,
      merchant_url: `${params.merchant}`,
      merchant_id: orderResponse.order[0].merchant_id,
      invoice_number: orderResponse.order[0].invoice_id,
      merchant_phone: orderResponse.order[0].merchant_phone,
      tng_image: orderResponse.order[0].tng_payment_qrcode,
      boost_image: orderResponse.order[0].boost_payment_qrcode,
      duit_now_image: orderResponse.order[0].duit_now_payment_qrcode,
      sarawak_pay_image: orderResponse.order[0].sarawak_pay_payment_qrcode,

      order_payment_method: orderResponse.order[0].payment_method,
      allow_receipt: orderResponse.order[0].allow_receipt,
      payment_status: orderResponse.order[0].payment_status,
      payment_receipt: orderResponse.order[0].payment_receipt,
      order_payment_receipt_extension:order_payment_receipt_extension,

      total_fee: orderResponse.order[0].total_amount,
      delivery_fee: orderResponse.order[0].delivery_fee,
      discount_amount: discount_amount,
      tax_fee: orderResponse.order[0].tax,
      coupon_discount_amount: coupon_discount_amount,
      bank_details: orderResponse.order[0].bank_details,
      note: orderResponse.order[0].note,
      p_color:p_color,
      s_color:s_color
      
    };
  },

  computed: {

    p_dark:function () {
      return this.text_color_auto(this.p_color);
    },

    s_dark:function () {
      return this.text_color_auto(this.s_color);
    }
  },
  mounted(){
    window.onbeforeunload = () => (this.unsavedChanges ? true : null);

    if(this.$route.query.oid && this.$route.query.allow_w){
          console.log('direct 1')
        this.order_id=this.$route.query.oid;
        this.allow_whatsapp=this.$route.query.allow_w;
        
        if(this.allow_whatsapp=='0' && this.allow_receipt!==0){

                this.send_whatsapp_notification_customer(this.order_id);
                this.send_whatsapp_notification_merchant(this.order_id);
        }
        this.$route.query.allow_w='1';
    }
   

  }
  ,
  created() {
    if (
      this.order_payment_method !== "3" && this.order_payment_method !== "4" && this.order_payment_method !== "5" &&this.order_payment_method !== "6" &&
      this.order_payment_method !== "0"
    ) {
      window.location.href = "https://emenu.com.my/" + this.merchant_url;
      return;
    }

    
  },
  methods: {
    contact_store() {
      window.location.href =
        "https://api.whatsapp.com/send?phone=" + this.merchant_phone;
    },
    continue_whatsapp() {
      // if (confirm(this.$t('confirm-payment')) == true) {
        window.location.href =
          "https://api.whatsapp.com/send?phone=" +
          this.merchant_phone +
          "&text=My%20order%7C%E6%88%91%E7%9A%84%E8%AE%A2%E5%8D%95%20-%3E%20%0A%0ANote:" +
          this.note +
          "%0Ahttps://cp.emenu.com.my/order/view-order.php?id=" +
          this.url;
      // }
    },
    text_color_auto(hexcolor) {
      // If a leading # is provided, remove it
      if (hexcolor.slice(0, 1) === "#") {
        hexcolor = hexcolor.slice(1);
      }

      // If a three-character hexcode, make six-character
      if (hexcolor.length === 3) {
        hexcolor = hexcolor
          .split("")
          .map(function (hex) {
            return hex + hex;
          })
          .join("");
      }

      // Convert to RGB value
      var r = parseInt(hexcolor.substr(0, 2), 16);
      var g = parseInt(hexcolor.substr(2, 2), 16);
      var b = parseInt(hexcolor.substr(4, 2), 16);

      // Get YIQ ratio
      var yiq = (r * 299 + g * 587 + b * 114) / 1000;

      // Check contrast
      return yiq >= 128 ? false : true;
    },
    receipt_upload() {
                    //  this.receipt_loading=true;
          console.log(this.image_file.type);
                        if (this.image_file !== undefined && this.image_file !== null && this.image_file !== '') {

                            if (this.image_file.size > 3072000) {
                                this.image_file='';
                                this.error_snackbar = true;
                                this.error_snackbar_text = "maximum size 3mb"
                                return;
                            }

                            if (this.image_file.type !=='image/png' && this.image_file.type !=='application/pdf' && this.image_file.type !=='image/jpg' &&  this.image_file.type !=='image/jpeg') {
                                this.image_file='';
                                this.error_snackbar = true;
                                this.error_snackbar_text = "png,jpg,jpeg,pdf only"
                                return;
                            }

                            const fr = new FileReader();
                            fr.readAsDataURL(this.image_file);

                            fr.addEventListener("load", () => {
                                this.image_url = fr.result;
                                console.log(this.image_url);
                                // var myImage = new Image();
                                // myImage.src="data:image/png;base64,"+fr.result; 
                                // this.testimage="data:image/png;base64,"+fr.result; 
                         
                                // const params = new URLSearchParams();
                                // params.append("upload_image", "upload_image");
                                // params.append("image_name", this.image_file.name);
                                // params.append("image", gallery_imageUrl);

                                // axios({
                                //     method: "post",
                                //     url: this.domain + "/merchant/form/index.php",
                                //     data: params
                                // })
                                //     .then(response => {
                                //         console.log('hehe');

                                //         console.log(response);
                                //         if (response.data.status == '1') {
                                                                                                         
                                       
                                        
                                //             this.image_file = '';
                                //             this.upload_product_gallery_dialog = false;

                                //         } else {

                                //             this.error_snackbar = true;
                                //             this.error_snackbar_text = "Upload Failed. Try again later";
                                //         }
                                //         this.gallery_image_loading=false;
                                //     })
                                //     .catch(error => {
                                //         console.log(error);
                                //     });
                            });



                        } else {
                            this.image_file = '';
                            this.error_snackbar = true;
                            this.error_snackbar_text = "Please select file"
                            // this.gallery_image_loading=false;
                        }
                     

    },
    open_upload_dialog(){
      this.receipt_dialog=true;
    },
    save_picture_and_go(){
      console.log(this.image_file.name);
   
        if (this.image_file.type !=='image/png' && this.image_file.type !=='application/pdf' && this.image_file.type !=='image/jpg' &&  this.image_file.type !=='image/jpeg') {
     
                               this.image_url='';
                               this.image_file='';
                                this.error_snackbar = true;
                                this.error_snackbar_text = "png, jpg, jpeg, pdf file only"
                                return;
        }
      if(this.image_file==''){
        return;

      }
      if (this.image_file.size > 3072000) {
                               this.image_url='';

                                this.image_file='';
                                this.error_snackbar = true;
                                this.error_snackbar_text = "maximum size 3mb"
                                return;
      }
  
                                const params = new URLSearchParams();
                                params.append("upload_receipt", "upload_image");
                                params.append("image", this.image_url);
                                params.append("image_name",  this.image_file.name);
                                params.append("url",  this.url);

                                axios({
                                    method: "post",
                                    url: this.domain + "/order/index.php",
                                    data: params
                                }).then(response => {

                                        console.log(response);
                                        if (response.data.status == '1') {     

                                            this.error_snackbar = true;
                                            this.error_snackbar_text = this.$t('success-upload');             
                                            this.image_file = '';
                                            this.receipt_dialog = false;
                                              if(this.allow_whatsapp=='0'){
                                              console.log('sendddd');
                                                    this.send_whatsapp_notification_customer(this.order_id);
                                                    this.send_whatsapp_notification_merchant(this.order_id);
                                            }


                                            var th=this;
                                            setTimeout(function () {
                                            th.$router.push('/'+th.merchant_url); 
                                              
                                            window.location.href =
                                            "https://api.whatsapp.com/send?phone=" +
                                            th.merchant_phone +
                                            "&text=My%20order%7C%E6%88%91%E7%9A%84%E8%AE%A2%E5%8D%95%20-%3E%20%0A%0ANote:" +
                                            th.note +
                                            "%0Ahttps://cp.emenu.com.my/order/view-order.php?id=" +
                                            th.url;


                                            }, 500);

                                          

                                        } else {

                                            this.error_snackbar = true;
                                            this.error_snackbar_text = "Upload Failed. Try again later";
                                        }
                                        this.gallery_image_loading=false;
                                    })
                                    .catch(error => {
                                        console.log(error);
                                    });                               

    },
    send_whatsapp_notification_customer(order_id){


      console.log(order_id);
      console.log('noti_customer');
      const params = new URLSearchParams();
      params.append("message_customer", '1');
      params.append("id", order_id);
  

      axios({
        method: "post",
        url: this.domain + "/whatsapp/index.php",
        data: params,
      })
        .then((response) => {
          console.log(response);
        })
        .catch((error) => {
          console.log(error);
        });
      
    },

    send_whatsapp_notification_merchant(order_id){

      
      console.log(order_id);
      console.log('noti_mercgabt');
      const params = new URLSearchParams();
      params.append("message_merchant", '1');
      params.append("id", order_id);
  

      axios({
        method: "post",
        url: this.domain + "/whatsapp/index.php",
        data: params,
      })
        .then((response) => {
          console.log(response);
        })
        .catch((error) => {
          console.log(error);
        });
      
    }

  },
};
</script>
<style>
.bank_detail p {
  line-height: 1;
  margin-bottom: 9px !important;
}
#error-not_found #contents,
#common-success #contents {
  border-radius: 5px;
  display: flex;
  align-items: center;
}
@media (min-width: 1025px) {
  .body-style.wide .home .box > div,
  .body-style.wide #contents:not(.home),
  .body-style.wide #header .container,
  .body-style.wide #footer > .container,
  .body-style.wide #footer #copyrights > .container {
    margin-left: auto;
    margin-right: auto;
    width: 100%;
  }
}
@media (min-width: 1025px) {
  .body-style.wide #contents {
    padding-top: 40px;
    padding-bottom: 40px;
  }
}
@media (min-width: 1025px) {
  .home .box > div,
  #contents:not(.home),
  #header .container,
  #footer > .container,
  #footer #copyrights > .container,
  #breadcrumb .breadcrumb {
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
  }
}
.body-style #contents {
  min-height: 300px;
}
@media (min-width: 1025px) {
  #contents {
    max-width: 1152px;
  }
}
#contents {
  display: flex;
  flex-direction: row;
  margin: 0px auto;
  flex: 1;
  -ms-flex: none;
  width: 100%;
  justify-content: center;
}
* {
  word-break: break-word;
  word-wrap: break-word;
}
*,
*::before,
*::after {
  box-sizing: inherit;
}
@media (min-width: 1025px) {
  .body-style.wide section:not(#product-category) #main-content {
    max-width: 100% !important;
  }
}
#contents #main-content {
  width: 100%;
  position: relative;
}
* {
  word-break: break-word;
  word-wrap: break-word;
}
*,
*::before,
*::after {
  box-sizing: inherit;
}
#common-success .content {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
}
#common-success .content .success-msg {
  width: 50%;
  padding: 50px;
}
#common-success #lottie {
  width: 150px;
  height: 150px;
  margin: auto;
  margin-bottom: 30px;
}
#common-success .message {
  text-align: center;
  background-color: transparent;
}
#common-success .content .qr-payment,
#common-success .content .advanced-payment {
  width: 50%;
  padding: 50px;
}
#common-success .content .qr-payment #e-payment,
#common-success .content .qr-payment #advanced-payment-content,
#common-success .content .advanced-payment #e-payment,
#common-success .content .advanced-payment #advanced-payment-content {
  border-left: 2px dashed #eee;
}
#error-not_found #e-payment .e-payment-container,
#error-not_found #advanced-payment-content .e-payment-container,
#common-success #e-payment .e-payment-container,
#common-success #advanced-payment-content .e-payment-container {
  max-width: 300px;
  margin: auto;
}
#error-not_found #e-payment .qr-code-msg,
#error-not_found #advanced-payment-content .qr-code-msg,
#common-success #e-payment .qr-code-msg,
#common-success #advanced-payment-content .qr-code-msg {
  font-weight: bold;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin: 30px 0px;
}
#error-not_found #e-payment .qr-code-container,
#error-not_found #advanced-payment-content .qr-code-container,
#common-success #e-payment .qr-code-container,
#common-success #advanced-payment-content .qr-code-container {
  border: 1px solid #eee;
  border-radius: 5px;
}
#error-not_found #e-payment .qr-code-container .qr-code-brand,
#error-not_found #advanced-payment-content .qr-code-container .qr-code-brand,
#common-success #e-payment .qr-code-container .qr-code-brand,
#common-success #advanced-payment-content .qr-code-container .qr-code-brand {
  border-bottom: 1px solid #eee;
  /* background-color: #0257b1; */
  display: flex;
  align-items: center;
  justify-content: center;
}
#error-not_found,
#common-success {
  text-align: center;
  display: flex;
}
@media (min-width: 1025px) {
  .body-style.wide .section {
    width: 100%;
  }
}
@media (min-width: 1025px) {
  .body-style.wide .container,
  .body-style.wide #contents.home {
    max-width: 100%;
    padding: 0px;
  }
}
.content:not(:last-child) {
  margin-bottom: 0px;
}
.box:not(:last-child),
.content:not(:last-child),
.notification:not(:last-child),
.progress:not(:last-child),
.table:not(:last-child),
.table-container:not(:last-child),
.title:not(:last-child),
.subtitle:not(:last-child),
.block:not(:last-child),
.highlight:not(:last-child),
.breadcrumb:not(:last-child),
.level:not(:last-child),
.list:not(:last-child),
.message:not(:last-child),
.tabs:not(:last-child) {
  margin-bottom: 1.5rem;
}
section.section {
  flex: 1 1 0%;
  -ms-flex: none;
  flex-direction: column;
  margin-bottom: 0px;
}
@media (min-width: 1025px) {
  .container {
    max-width: 1152px;
  }
}
.container {
  margin: 0 auto;
  position: relative;
}
#error-not_found #contents,
#common-success #contents {
  border-radius: 5px;
  display: flex;
  align-items: center;
}
@media (min-width: 1025px) {
  .body-style.wide .home .box > div,
  .body-style.wide #contents:not(.home),
  .body-style.wide #header .container,
  .body-style.wide #footer > .container,
  .body-style.wide #footer #copyrights > .container {
    margin-left: auto;
    margin-right: auto;
    width: 100%;
  }
}

@media (min-width: 1025px) {
  .body-style.wide #contents {
    padding-top: 40px;
    padding-bottom: 40px;
  }
}
@media (min-width: 1025px) {
  .home .box > div,
  #contents:not(.home),
  #header .container,
  #footer > .container,
  #footer #copyrights > .container,
  #breadcrumb .breadcrumb {
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
  }
}
.body-style #contents {
  min-height: 300px;
}
#contents {
  display: flex;
  flex-direction: row;
  margin: 0px auto;
  flex: 1;
  -ms-flex: none;
  width: 100%;
  justify-content: center;
}
@media (min-width: 1025px) {
  .body-style.wide section:not(#product-category) #main-content {
    max-width: 100% !important;
  }
}
#contents #main-content {
  width: 100%;
  position: relative;
}
#error-not_found #e-payment .qr-code-container .qr-code-brand img,
#error-not_found
  #advanced-payment-content
  .qr-code-container
  .qr-code-brand
  img,
#common-success #e-payment .qr-code-container .qr-code-brand img,
#common-success
  #advanced-payment-content
  .qr-code-container
  .qr-code-brand
  img {
  width: 270px;
}
img {
  height: auto;
  max-width: 100%;
}
@media (max-width: 1024px) {
  #common-success .content .success-msg {
    width: 100%;
    padding: 20px;
  }
}
@media (max-width: 1024px) {
  #common-success .content .qr-payment,
  #common-success .content .advanced-payment {
    width: 100%;
    padding: 20px;
  }
}
@media (max-width: 1024px) {
  #common-success .content .qr-payment #e-payment,
  #common-success .content .qr-payment #advanced-payment-content,
  #common-success .content .advanced-payment #e-payment,
  #common-success .content .advanced-payment #advanced-payment-content {
    border-top: 2px dashed #eee;
    border-left: 0px;
  }
}
</style>
